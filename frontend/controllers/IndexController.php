<?php

namespace frontend\controllers;
use Yii;
use yii\web\Controller;
use common\models\WxGoods;
use common\models\WxUser;

class IndexController extends Controller
{
    /**
     * @var string
     */
//    public $layout = 'main';
    public $layout = 'kjmain';

    /**
     * @var
*/
    public function init()
    {
        //平台验证和授权验证
        if (Yii::$app->wechat->isWechat && !Yii::$app->wechat->isAuthorized()){
            Yii::$app->wechat->authorizeRequired()->send();
        }
        if(!Yii::$app->session->has("userinfo")){
//            (new WxUser)->createUser();
        }
        parent::init(); // TODO: Change the autogenerated stub
    }

    public function actionIndex(){
        //验证服务器
        if (Yii::$app->request->get('echostr',false)){
            //执行服务端业务
            $response = Yii::$app->wechat->server->serve();
            // 将响应输出
            $response->send();
        }
        //判断是否为授权用户

        //业务页面，也就是需要授权才能访问的页面
        //砍价活动页
        return $this->render('kanjia');
    }

    /**
     * @return 砍价详情
     */
    public function actionDetail(){
        return $this->render('kj-detail');
    }

    /**
     * @return 用户中心
     */
    public function actionUser(){
        if (Yii::$app->request->isPjax){

        }else{

        }
        return $this->render('user');
    }

    public function actionClear(){
        Yii::$app->session->removeAll();
        p(Yii::$app->session);
    }
}
